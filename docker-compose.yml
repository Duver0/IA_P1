# ⚕️ HUMAN CHECK - Configuración de Docker Compose
# Revisar puertos expuestos y variables de entorno antes de desplegar
services:
  backend:
    build:
      context: ./backend/producer
      dockerfile: Dockerfile
    ports:
      - "${BACKEND_PORT:-3000}:3000"
    volumes:
      - ./backend/producer:/app
      - /app/node_modules
      - /app/dist
    environment:
      - NODE_ENV=development
      - PORT=3000
      - RABBITMQ_URL=amqp://rabbitmq:5672
      - RABBITMQ_QUEUE=turnos_queue
    depends_on:
      - rabbitmq
    networks:
      - app-network

  consumer:
    build:
      context: ./backend/consumer
      dockerfile: Dockerfile
    volumes:
      - ./backend/consumer:/app
      - /app/node_modules
      - /app/dist
    environment:
      - NODE_ENV=development
      - RABBITMQ_URL=amqp://rabbitmq:5672
      - RABBITMQ_QUEUE=turnos_queue
    depends_on:
      - rabbitmq
    networks:
      - app-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "${FRONTEND_PORT:-3001}:3001"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_API_URL=http://backend:3000
    depends_on:
      - backend
    networks:
      - app-network

  # ⚕️ HUMAN CHECK - Configuración de RabbitMQ
  # Cambiar credenciales por defecto antes de ir a producción
  rabbitmq:
    image: rabbitmq:3-management-alpine
    ports:
      - "${RABBITMQ_PORT:-5672}:5672"
      - "${RABBITMQ_MGMT_PORT:-15672}:15672"
    environment:
      - RABBITMQ_DEFAULT_USER=${RABBITMQ_USER:-guest}
      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_PASS:-guest}
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
